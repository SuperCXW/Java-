# DDD
ddd读写分离
遇到的问题

DDD 常用数据结构复杂度


1. DDD是什么
    - 主要可以帮助我们解决传统单体式集中架构难以快速响应业务需求落地的问题，并且针对中台和微服务盛行的场景做出指导。
    - DDD为我们提供的是架构设计的方法论，既面向技术也面向业务，从业务的角度来把握设计方案。

2. DDD的作用
    - 统一思想  统一各方么 产品 业务 开发的对问题的认知,
    - 明确分工  域模型需要明确定义来解决方方面面的问题
    - 反映变化  需求是不断变化的因此我们的模型是不断变化的
    - 边界分离  领域模型与数据模型分离，用领域模型来界定哪些需求在什么地方实现，保持结构清晰。

3. 概念
    - 实体
        - 有唯一标志的领域对象,且这个标志在整个软件生命周期中都不会发生变化,但是不是面向数据库的,而是面向业务行为的实体,通过唯一ID来确认每个实体
    - 值对象
        - 依附于实体存在通过对象属性来识别对象,  对于值对象来说,无法根据全局唯一ID来区分,只能通过比对属性来匹配  不可变对象,只能直接创建
    - 聚合
        - 实体和值对象面向的是个体,聚合面向的是整个业务的协同和组织,聚合是数据修改和持久化的基本单元,同一个聚合要保证在事务中
    - 聚合根
        - 也叫根实体, 聚合根是主要的业务逻辑载体，DDD中所有的战术实现都围绕着聚合根展开。
    - 领域服务
        - 有些领域的操作是一些动词,并不能简单的把他们归类到某个实体或者值对象中.这样的行为从领域中识别出来应该将它声明为领域服务,它的作用仅仅是为领域提供相关的功能
    - 领域事件
        - 在特定的领域由用户触发的,发生在过去的事件
    - 资源库
        - 对聚合根的持久化

4. 四种模式
    - 失血模型
        - 只有数据模型
    - 贫血模型
        - 数据模型加上业务领域行为
    - 充血模型
        - 数据模型 + 业务领域行为 + 持久化
    - 胀血模型
        - 包含所有领域相关的代码,数据行为持计划业务组合

5. 分析方法
    - 用例分析法
        - 获取用例 提取领域规则描述
        - 收集实体  定位实体
        - 添加关联  各个实体之间通过动词链接
        - 添加属性  获取实体属性
        - 模型精化  做子领域划分
    - 四色模型法
    - 事件风暴法


6. 实现方法
    - 失血模型+ service领域服务
    - 基于事务脚本实现  ps:适合面向简单系统
    - 基于领域对象实现 业务被包含在领域模型中

7. DDD的写方法
    - 创建聚合根通过Factory完成；
    - 业务逻辑优先在聚合根边界内完成；
    - 聚合根中不合适放置的业务逻辑才考虑放到DomainService中。

8. DDD的读方式
    - 领域模型读取 类似写操作,读出来后领域对象转换为对外模型 但是复杂查询会导致repo变得更复杂,受限于聚合根的边界划分
    - 数据模型读取, 直通数据库,读写分离,不拘泥于领域模型读取,简化流程提升性能   但数据库模型依赖聚合根模型简历,所以还是受到了领域模型影响
    - CQRS 命令查询职责分离，这里的命令可以理解为写操作，而查询可以理解为读操作。与“基于数据模型的读操作”不同的是，在CQRS中写操作和读操作使用了不同的数据库，数据从写模型数据库同步到读模型数据库，通常通过领域事件的形式同步变更信息。
#### ZK
- zookeeper主要服务于分布式系统， 可以用zk来做统一配置管理，统一命名服务，分布式锁，集群管理 所有znode存在在内存中
- 分布式系统无法避免节点管理，zookeeper提供了通用解决方案
- 可靠性
    - 事务日志 和快照文件保证数据可靠性
- 基于树的数据结构，每个节点都是ZNode
    -  Znode有持久和临时节点，区分到期时间
    - 还有顺序和非顺序节点 Sequential zk会自动添加一个数字在后面
    - 还有监听器，来监听Znode的数据变化，还有子节点的增减
- 分布式锁
    - 按照顺序添加顺序节点，然后监视比自己小的节点，如果比自己小的节点释放掉，就拿到锁了，执行完释放掉自己
- 动态选举master


- 集群
    - 角色
        - Leader 为客户提供读写服务
        - Follower 提供读服务，写服务转发给Leader
        - Observer 为客户端提供读服务，不参与选举
    - 会话
        - 客户端与zk之前的长连接
        - 通过心跳检查客户端连接
        - 客户端接收Watch事件通知
        - 会话存在超时时间设置
    - 版本
        - Version zNode版本 每次写操作都会添加版本
        - Cvserion 子节点版本 有操作也+1
        - Aversion ACL访问控制版本
        - 通过CAS保证并发安全
    - ACL 基于每个ZNode节点来做的，无法继承权限
        - CREATE   
        - READ
        - WRITE
        - DELETE
        - ADMIN
    - Znode
        - 临时 持久 临时节点依赖客户端会话，临时节点不能有子节点
        - Sequential 决定节点顺序
    - zxid zk事务Id，通过事务ID，确定更新的先后顺序
        - czxid 创建节点的事务Id
        - mzxid 最后一次修改的事务Id
        - 通过事务Id，保证每次客户端连接的节点数据都是一致的
- watcher
    - client注册watch，服务端触发watch，会向客户端通知 通过ZAB协议
    - 一次触发后就会失效
- ZAB协议
    - 集群在半数一下节点宕机情况下，能保持可用性，leader发布消息时，有半数ack即可完成事务
